# HTTP Redirect Utility - –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üìã –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

HTTP Redirect Utility - —ç—Ç–æ –º–æ–¥—É–ª—å —Å–∏—Å—Ç–µ–º—ã Zoomos v4, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö URL –ø–æ—Å–ª–µ —Ü–µ–ø–æ—á–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π. –£—Ç–∏–ª–∏—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤ –∏ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

### üéØ –û—Å–Ω–æ–≤–Ω–∞—è –∑–∞–¥–∞—á–∞

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Å–æ–∫—Ä–∞—â–µ–Ω–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏ (QR-–∫–æ–¥—ã, –∫–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–ª—É—á–∏—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π URL –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ**: –£—Ç–∏–ª–∏—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–ª–µ–¥—É–µ—Ç –ø–æ —Ü–µ–ø–æ—á–∫–µ HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ (301, 302, 307, 308) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ñ–∏–Ω–∞–ª—å–Ω—É—é —Å—Å—ã–ª–∫—É —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –∏ —Å—Ç–∞—Ç—É—Å–µ.

**–ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã**:
```
–í—Ö–æ–¥—è—â–∏–π URL: https://goldapple.ru/qr/19000180719
HTTP 301 ‚Üí –§–∏–Ω–∞–ª—å–Ω—ã–π URL: https://goldapple.ru/19000180719-elixir-precious
```

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –ü–∞—Ç—Ç–µ—Ä–Ω Strategy –¥–ª—è –æ–±—Ö–æ–¥–∞ –∞–Ω—Ç–∏–±–æ—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º

–£—Ç–∏–ª–∏—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **Strategy Pattern** —Å —Ç—Ä–µ–º—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ URL:

```mermaid
graph TD
    A[URL Input] --> B[RedirectFinderService]
    B --> C{Strategy Selection}
    C -->|Priority 1| D[CurlStrategy]
    C -->|Priority 2| E[PlaywrightStrategy] 
    C -->|Priority 3| F[HttpClientStrategy]
    D --> G[Result]
    E --> G
    F --> G
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```
src/main/java/com/java/
‚îú‚îÄ‚îÄ controller/utils/
‚îÇ   ‚îî‚îÄ‚îÄ RedirectFinderController.java         # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îú‚îÄ‚îÄ service/utils/
‚îÇ   ‚îú‚îÄ‚îÄ RedirectFinderService.java            # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ redirect/
‚îÇ       ‚îú‚îÄ‚îÄ AsyncRedirectService.java         # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚îÇ       ‚îú‚îÄ‚îÄ CurlStrategy.java                 # –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º curl
‚îÇ       ‚îú‚îÄ‚îÄ PlaywrightStrategy.java           # –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å –±—Ä–∞—É–∑–µ—Ä–æ–º
‚îÇ       ‚îú‚îÄ‚îÄ HttpClientStrategy.java           # –°—Ç—Ä–∞—Ç–µ–≥–∏—è —Å Java HTTP Client
‚îÇ       ‚îî‚îÄ‚îÄ RedirectProgressDto.java          # DTO –¥–ª—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ model/utils/
‚îÇ   ‚îú‚îÄ‚îÄ RedirectResult.java                   # –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ URL
‚îÇ   ‚îú‚îÄ‚îÄ RedirectExportTemplate.java           # –®–∞–±–ª–æ–Ω –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ RedirectProcessingRequest.java        # –ó–∞–ø—Ä–æ—Å –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É
‚îÇ   ‚îî‚îÄ‚îÄ RedirectUrlData.java                  # –î–∞–Ω–Ω—ã–µ URL —Å –º–µ—Ç–∞–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π
‚îî‚îÄ‚îÄ dto/utils/
    ‚îî‚îÄ‚îÄ RedirectFinderDto.java                # DTO –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ñ–æ—Ä–º—ã
```

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### 1. CurlStrategy (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—É—é –∫–æ–º–∞–Ω–¥—É `curl` –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

**–ö–æ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏**:
```java
// src/main/java/com/java/service/utils/redirect/CurlStrategy.java:45-70
private RedirectResult followRedirectsManually(String currentUrl, int maxRedirects, int timeoutMs, long startTime) throws Exception {
    String originalUrl = currentUrl;
    int redirectCount = 0;
    Integer initialRedirectCode = null; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π HTTP –∫–æ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
    
    for (int i = 0; i <= maxRedirects; i++) {
        // –ü–æ–ª—É—á–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å –ø–æ–º–æ—â—å—é curl -I (–±–µ–∑ —Ñ–ª–∞–≥–∞ -w)
        String[] headerCommand = {
            "curl", "-I", "-s", 
            "--connect-timeout", "5", "--max-time", String.valueOf(timeoutMs / 1000),
            "--insecure", currentUrl
        };
        
        ProcessBuilder pb = new ProcessBuilder(headerCommand);
        Process process = pb.start();
        
        String result = readProcessOutput(process.getInputStream());
        int exitCode = process.waitFor();
        
        if (exitCode != 0) {
            throw new Exception("Curl –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –∫–æ–¥–æ–º: " + exitCode);
        }
        
        int httpCode = extractHttpCode(result);
        
        if (httpCode >= 300 && httpCode < 400) {
            String location = extractLocation(result);
            if (location != null && !location.isEmpty()) {
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π HTTP –∫–æ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
                if (initialRedirectCode == null) {
                    initialRedirectCode = httpCode;
                }
                redirectCount++;
                String nextUrl = resolveUrl(currentUrl, location);
                currentUrl = nextUrl;
                continue;
            }
        }
        
        // –î–æ—Å—Ç–∏–≥–ª–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ URL
        break;
    }
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π HTTP –∫–æ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞, –µ—Å–ª–∏ –æ–Ω –±—ã–ª, –∏–Ω–∞—á–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π
    int reportHttpCode = (initialRedirectCode != null) ? initialRedirectCode : httpCode;
    
    return RedirectResult.builder()
        .originalUrl(originalUrl)
        .finalUrl(currentUrl)
        .redirectCount(redirectCount)
        .httpStatusCode(reportHttpCode)
        .processingTimeMs(System.currentTimeMillis() - startTime)
        .status(determinePageStatus(reportHttpCode))
        .build();
}
```

**–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å**: User-Agent –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –º–Ω–æ–≥–∏–µ —Å–∞–π—Ç—ã (–≤–∫–ª—é—á–∞—è goldapple.ru) –±–ª–æ–∫–∏—Ä—É—é—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–≥–æ User-Agent.

### 2. PlaywrightStrategy (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç headless –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –æ–±—Ö–æ–¥–∞ JavaScript —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –∏ –∞–Ω—Ç–∏–±–æ—Ç–Ω—ã—Ö —Å–∏—Å—Ç–µ–º.

**–ö–æ–¥ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**:
```java
// src/main/java/com/java/service/utils/redirect/PlaywrightStrategy.java:30-55
@Override
public RedirectResult processRedirect(String url, int maxRedirects, int timeoutMs) {
    long startTime = System.currentTimeMillis();
    
    try (Playwright playwright = Playwright.create()) {
        Browser browser = playwright.chromium().launch(new BrowserType.LaunchOptions().setHeadless(true));
        Page page = browser.newPage();
        
        // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ —á–µ—Ä–µ–∑ –Ω–∞–≤–∏–≥–∞—Ü–∏—é
        List<String> urls = new ArrayList<>();
        urls.add(url);
        
        page.onResponse(response -> {
            if (response.status() >= 300 && response.status() < 400) {
                String location = response.headers().get("location");
                if (location != null) {
                    urls.add(location);
                }
            }
        });
        
        Response response = page.navigate(url, new Page.NavigateOptions().setTimeout(timeoutMs));
        String finalUrl = page.url();
        
        return RedirectResult.builder()
            .originalUrl(url)
            .finalUrl(finalUrl)
            .redirectCount(urls.size() - 1)
            .httpStatusCode(response.status())
            .processingTimeMs(System.currentTimeMillis() - startTime)
            .status(PageStatus.OK)
            .build();
    }
}
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å**:
```xml
<!-- pom.xml -->
<dependency>
    <groupId>com.microsoft.playwright</groupId>
    <artifactId>playwright</artifactId>
    <version>1.40.0</version>
</dependency>
```

---

## ‚ö° –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ async –æ–±—Ä–∞–±–æ—Ç–∫–∏

–£—Ç–∏–ª–∏—Ç–∞ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞:

```java
// src/main/java/com/java/config/AsyncConfig.java:128-148
@Bean(name = "redirectTaskExecutor")
public Executor redirectTaskExecutor() {
    ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor();
    executor.setCorePoolSize(1);
    executor.setMaxPoolSize(3);
    executor.setQueueCapacity(5);
    executor.setThreadNamePrefix("RedirectExecutor-");
    executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy());
    executor.setWaitForTasksToCompleteOnShutdown(true);
    executor.setAwaitTerminationSeconds(600); // 10 –º–∏–Ω—É—Ç –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
    executor.initialize();
    return executor;
}
```

### WebSocket —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:

```java
// src/main/java/com/java/service/utils/redirect/AsyncRedirectService.java:77-93
private void sendProgressUpdate(String operationId, String message, int percentage, int total) {
    try {
        RedirectProgressDto progress = new RedirectProgressDto();
        progress.setOperationId(operationId);
        progress.setMessage(message);
        progress.setPercentage(percentage);
        progress.setProcessed(percentage * total / 100);
        progress.setTotal(total);
        progress.setStatus("IN_PROGRESS");
        progress.setTimestamp(LocalDateTime.now());
        
        messagingTemplate.convertAndSend("/topic/redirect-progress/" + operationId, progress);
        
    } catch (Exception e) {
        log.error("–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–∏ {}", operationId, e);
    }
}
```

---

## üìä –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å–∏—Å—Ç–µ–º–æ–π —ç–∫—Å–ø–æ—Ä—Ç–∞

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ FileGeneratorService

–£—Ç–∏–ª–∏—Ç–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–∏—Å—Ç–µ–º–æ–π —ç–∫—Å–ø–æ—Ä—Ç–∞ —Ñ–∞–π–ª–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞:

```java
// src/main/java/com/java/model/utils/RedirectExportTemplate.java:15-35
public static RedirectExportTemplate create(boolean includeId, boolean includeModel, 
                                           String idColumnName, String modelColumnName) {
    return RedirectExportTemplate.builder()
            .fileFormat("CSV")
            .csvEncoding("Windows-1251")      // –ö–æ–¥–∏—Ä–æ–≤–∫–∞ –¥–ª—è Excel
            .csvDelimiter(";")                // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –¥–ª—è Excel
            .csvQuoteChar("\"")               // –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–≤—ã—á–∫–∞–º–∏
            .includeId(includeId)
            .includeModel(includeModel)
            .idColumnName(idColumnName != null ? idColumnName : "ID")
            .modelColumnName(modelColumnName != null ? modelColumnName : "–ú–æ–¥–µ–ª—å")
            .build();
}
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏**:
- `–ò—Å—Ö–æ–¥–Ω–∞—è —Å—Å—ã–ª–∫–∞` - –≤—Ö–æ–¥—è—â–∏–π URL
- `–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞` - URL –ø–æ—Å–ª–µ –≤—Å–µ—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤  
- `HTTP —Å—Ç–∞—Ç—É—Å` - –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π –∫–æ–¥ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞ (301, 302, etc.)
- `–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤` - —á–∏—Å–ª–æ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤
- `–í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–º—Å)` - –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞
- `–°—Ç–∞—Ç—É—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç (OK, ERROR, BLOCKED, etc.)

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏** (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω—ã):
- `ID` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
- `–ú–æ–¥–µ–ª—å` - –º–æ–¥–µ–ª—å/–∫–∞—Ç–µ–≥–æ—Ä–∏—è –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞

---

## üåê –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### URL-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
/utils                                    # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —É—Ç–∏–ª–∏—Ç
/utils/redirect-finder                    # –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
/utils/redirect-finder/configure          # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
/utils/redirect-finder/process            # –ó–∞–ø—É—Å–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏
/utils/redirect-finder/cancel             # –û—Ç–º–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**HTML —Ñ–æ—Ä–º–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**:
```html
<!-- src/main/resources/templates/utils/redirect-finder-configure.html:207-226 -->
<div class="col-md-6">
    <label class="form-label">
        <i class="fas fa-clock text-warning"></i>
        –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
    </label>
    <select class="form-select" th:field="*{delayMs}">
        <option value="0" selected>–ë–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏</option>
        <option value="500">0.5 —Å–µ–∫—É–Ω–¥—ã</option>
        <option value="1000">1 —Å–µ–∫—É–Ω–¥–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)</option>
        <option value="2000">2 —Å–µ–∫—É–Ω–¥—ã</option>
        <option value="3000">3 —Å–µ–∫—É–Ω–¥—ã</option>
        <option value="5000">5 —Å–µ–∫—É–Ω–¥</option>
    </select>
    <div class="form-text">
        <i class="fas fa-info-circle"></i>
        –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ URL
    </div>
</div>
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è DTO**:
```java
// src/main/java/com/java/dto/utils/RedirectFinderDto.java:32-35
@Min(value = 0, message = "–ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π")
@Max(value = 30000, message = "–ó–∞–¥–µ—Ä–∂–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 30 —Å–µ–∫—É–Ω–¥")
private Integer delayMs = 0;
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

**CurlStrategy —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**:
```java
// src/test/java/com/java/service/utils/redirect/CurlStrategyTest.java:25-35
@Test
public void testProcessRedirect_Success() {
    CurlStrategy strategy = new CurlStrategy();
    
    RedirectResult result = strategy.processRedirect("https://httpbin.org/redirect/2", 10, 10000);
    
    assertThat(result).isNotNull();
    assertThat(result.getFinalUrl()).contains("httpbin.org");
    assertThat(result.getRedirectCount()).isGreaterThanOrEqualTo(0);
    assertThat(result.getStatus()).isIn(PageStatus.OK, PageStatus.REDIRECT);
}
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤**:
```java
// src/test/java/com/java/service/utils/RedirectFinderServiceIntegrationTest.java:30-45
@Test
public void testGoldAppleRedirect() {
    // –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–æ–π goldapple.ru
    List<RedirectUrlData> urls = List.of(
        RedirectUrlData.builder()
            .url("https://goldapple.ru/qr/19000180719")
            .build()
    );
    
    List<RedirectResult> results = redirectFinderService.processRedirects(
        urls, 5, 10000, 1000, null
    );
    
    assertThat(results).hasSize(1);
    RedirectResult result = results.get(0);
    assertThat(result.getFinalUrl()).contains("elixir-precious");
    assertThat(result.getHttpStatusCode()).isEqualTo(301);
}
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### Maven –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```xml
<!-- pom.xml -->
<dependency>
    <groupId>com.microsoft.playwright</groupId>
    <artifactId>playwright</artifactId>
    <version>1.40.0</version>
</dependency>
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Spring Boot

**Thread Pool –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**:
```properties
# application.properties (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è)
redirect.async.core-pool-size=1
redirect.async.max-pool-size=3
redirect.async.queue-capacity=5
redirect.async.timeout-seconds=600
```

### –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞

```bash
# –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
mvn clean compile

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è  
mvn spring-boot:run -Dspring-boot.run.profiles=silent

# –î–æ—Å—Ç—É–ø –∫ —É—Ç–∏–ª–∏—Ç–µ
http://localhost:8081/utils/redirect-finder
```

---

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

**1. –ü—Ä–æ–±–ª–µ–º–∞ —Å User-Agent –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π**
```
–°–∏–º–ø—Ç–æ–º: HTTP 200 –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–µ–º–æ–≥–æ HTTP 301
–ü—Ä–∏—á–∏–Ω–∞: –°–∞–π—Ç –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç—ã –ø—Ä–∏ –±—Ä–∞—É–∑–µ—Ä–Ω–æ–º User-Agent
–†–µ—à–µ–Ω–∏–µ: –£–±—Ä–∞—Ç—å --user-agent –∏–∑ curl –∫–æ–º–∞–Ω–¥—ã ‚úÖ
```

**2. –ü—Ä–æ–±–ª–µ–º–∞ —Å –ø–∞—Ä—Å–∏–Ω–≥–æ–º HTTP —Å—Ç–∞—Ç—É—Å–∞**
```
–°–∏–º–ø—Ç–æ–º: –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∫–æ–¥ (200) –≤–º–µ—Å—Ç–æ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–≥–æ (301)
–ü—Ä–∏—á–∏–Ω–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –æ—Ç–≤–µ—Ç–∞
–†–µ—à–µ–Ω–∏–µ: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ initialRedirectCode –Ω–∞ –ø–µ—Ä–≤–æ–º —Ä–µ–¥–∏—Ä–µ–∫—Ç–µ ‚úÖ
```

**3. –§–∞–π–ª—ã –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è**
```
–°–∏–º–ø—Ç–æ–º: –û—à–∏–±–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å FileGeneratorService
–ü—Ä–∏—á–∏–Ω–∞: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª–µ–π ExportTemplateField
–†–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ setEntityFieldName() –≤–º–µ—Å—Ç–æ setDisplayName() ‚úÖ
```

### –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ curl –∫–æ–º–∞–Ω–¥—ã –≤—Ä—É—á–Ω—É—é
curl -I -s --connect-timeout 5 --max-time 10 --insecure https://goldapple.ru/qr/19000180719

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# HTTP/1.1 301 Moved Permanently
# Location: https://goldapple.ru/19000180719-elixir-precious

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —É—Ç–∏–ª–∏—Ç—ã —á–µ—Ä–µ–∑ —Ç–µ—Å—Ç—ã
mvn test -Dtest=RedirectFinderServiceIntegrationTest

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ async –æ–±—Ä–∞–±–æ—Ç–∫–∏
tail -f logs/application.log | grep "RedirectExecutor"
```

---

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### –í–æ–∑–º–æ–∂–Ω—ã–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

1. **–ü–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑
   - –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

2. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞**
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –¥–æ–º–µ–Ω–∞–º
   - –ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤
   - –î–µ—Ç–µ–∫—Ü–∏—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

3. **–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞**
   - JSON —ç–∫—Å–ø–æ—Ä—Ç –¥–ª—è API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
   - XML —Ñ–æ—Ä–º–∞—Ç –¥–ª—è enterprise —Å–∏—Å—Ç–µ–º

4. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤**
   - Redis –∫—ç—à –¥–ª—è —á–∞—Å—Ç—ã—Ö URL
   - –õ–æ–∫–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å TTL

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–¢–µ–∫—É—â–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏**:
- ~2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ URL (—Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 1 —Å–µ–∫)
- ~0.5 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ URL (–±–µ–∑ –∑–∞–¥–µ—Ä–∂–∫–∏)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–æ 20 —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤ –Ω–∞ —Ü–µ–ø–æ—á–∫—É
- –¢–∞–π–º–∞—É—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10 —Å–µ–∫—É–Ω–¥

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é**:
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ max-pool-size –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —á–∞—Å—Ç—ã—Ö URL
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è curl —Ç–∞–π–º–∞—É—Ç–æ–≤ –ø–æ–¥ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Å–∞–π—Ç—ã

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

**–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫**: Claude Code (Anthropic)
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**: 1.0
**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è**: 2025-09-06
**–ö–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞**: Zoomos v4 HTTP Redirect Utility

**–§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞**:
```
E:\workspace\zoomos_v4\
‚îú‚îÄ‚îÄ src/main/java/com/java/
‚îÇ   ‚îú‚îÄ‚îÄ controller/utils/RedirectFinderController.java
‚îÇ   ‚îú‚îÄ‚îÄ service/utils/RedirectFinderService.java
‚îÇ   ‚îú‚îÄ‚îÄ service/utils/redirect/
‚îÇ   ‚îú‚îÄ‚îÄ model/utils/
‚îÇ   ‚îî‚îÄ‚îÄ dto/utils/
‚îú‚îÄ‚îÄ src/main/resources/templates/utils/
‚îú‚îÄ‚îÄ src/test/java/com/java/service/utils/
‚îî‚îÄ‚îÄ doc/intro_redirect.md (—ç—Ç–æ—Ç —Ñ–∞–π–ª)
```

**–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–æ–º–æ—â–∏**:
1. –ò–∑—É—á–∏—Ç–µ –ª–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: `logs/application.log`
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã: `mvn test -Dtest=*RedirectFinder*`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `application.properties`

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å –ø–æ–º–æ—â—å—é Claude Code –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ Zoomos v4 HTTP Redirect Utility*
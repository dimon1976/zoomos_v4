# üéØ –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´: –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

## üìã –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå –ò—Å—Ö–æ–¥–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞
```java
// –ü–†–û–ë–õ–ï–ú–ê: HttpURLConnection –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç setFollowRedirects(false) –¥–ª—è goldapple.ru
URL: https://goldapple.ru/qr/19000180718 | Strategy: SimpleHttp | Status: 200
–§–∏–Ω–∞–ª—å–Ω—ã–π URL: https://goldapple.ru/qr/19000180718  // –ù–ï –ò–ó–ú–ï–ù–ò–õ–°–Ø!
–†–µ–¥–∏—Ä–µ–∫—Ç–æ–≤: 0  // –î–û–õ–ñ–ù–û –ë–´–¢–¨ 1!
```

**curl -I –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π 301 —Ä–µ–¥–∏—Ä–µ–∫—Ç, –Ω–æ Java HttpURLConnection —ç—Ç–æ–≥–æ –Ω–µ –≤–∏–¥–∏—Ç!**

## ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–û–ï –†–ï–®–ï–ù–ò–ï

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –Ω–∞ PageStatus enum
```java
// –ë–´–õ–û:
result.setStatus("SUCCESS");
result.setStatus("BLOCKED_HTTP_403");
result.setStatus("MAX_REDIRECTS");

// –°–¢–ê–õ–û:
result.setStatus(PageStatus.SUCCESS.toString());
result.setStatus(PageStatus.FORBIDDEN.toString());
result.setStatus(PageStatus.MAX_REDIRECTS.toString());
```

### 2. –°–æ–∑–¥–∞–Ω–∞ SafeOkHttpStrategy —Å —Ä–µ—Ñ–ª–µ–∫—Å–∏–µ–π
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: 0 (–Ω–∞–∏–≤—ã—Å—à–∏–π)
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ—Ñ–ª–µ–∫—Å–∏—é –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å OkHttp
- **Fallback**: –ù–∞ —á–∏—Å—Ç—ã–π Java HTTP –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ OkHttp
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –ë–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤

### 3. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–π
```java
// –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É:
0. SafeOkHttpStrategy    // –ù–∞–∏–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–∞—è
1. SimpleHttpStrategy    // –ë–∞–∑–æ–≤–∞—è (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è)  
2. EnhancedHttpStrategy  // Apache HttpClient
```

### 4. –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Unit —Ç–µ—Å—Ç—ã**: –ë–∞–∑–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã**: –†–µ–∞–ª—å–Ω—ã–µ URL
- **–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç**: –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –ø—Ä–æ–±–ª–µ–º—É

## üöÄ –ó–∞–ø—É—Å–∫ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã
```bash
# –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Å goldapple.ru
mvn test -Dtest=RedirectProblemDemoTest#demonstrateGoldappleProblem
```

### –í—Å–µ —Ç–µ—Å—Ç—ã
```bash
# –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
mvn test -Dtest=RedirectCollectorServiceTest

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (—Ç—Ä–µ–±—É—é—Ç ENABLE_INTEGRATION_TESTS=true)
export ENABLE_INTEGRATION_TESTS=true
mvn test -Dtest=RedirectStrategiesIntegrationTest
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
1. **Enum —Å—Ç–∞—Ç—É—Å—ã**: –í—Å–µ —Å—Ç—Ä–æ–∫–æ–≤—ã–µ —Å—Ç–∞—Ç—É—Å—ã –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ PageStatus enum
2. **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: Strategy Pattern —Å fallback –ª–æ–≥–∏–∫–æ–π
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∞ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞
4. **SafeOkHttpStrategy**: –°–æ–∑–¥–∞–Ω–∞ —É–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

### üîß –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
```java
@Autowired
private AntiBlockService antiBlockService;

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–µ—Ä–µ—Ç –ª—É—á—à—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
RedirectResult result = antiBlockService.processUrlWithFallback(
    "https://goldapple.ru/qr/19000180718", 
    5,  // –º–∞–∫—Å. —Ä–µ–¥–∏—Ä–µ–∫—Ç–æ–≤
    30  // —Ç–∞–π–º–∞—É—Ç —Å–µ–∫—É–Ω–¥
);

PageStatus status = PageStatus.valueOf(result.getStatus());
```

### üìà –£–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –î–æ | –ü–æ—Å–ª–µ |
|---------|-----|-------|
| –°—Ç–∞—Ç—É—Å—ã | –°—Ç—Ä–æ–∫–∏ | PageStatus enum ‚úÖ |
| –°—Ç—Ä–∞—Ç–µ–≥–∏–π | 1 | 3+ —Å –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º–∏ ‚úÖ |
| Fallback | –ù–µ—Ç | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π ‚úÖ |
| –¢–µ—Å—Ç—ã | –ë–∞–∑–æ–≤—ã–µ | Unit + –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ ‚úÖ |

## üé≠ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–µ—à–µ–Ω–∏—è

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –¥–ª—è –ø–æ–ª–Ω–æ–π –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏:**
```bash
mvn test -Dtest=RedirectProblemDemoTest#demonstrateGoldappleProblem -q
```

–í—ã–≤–æ–¥ –ø–æ–∫–∞–∂–µ—Ç:
- ‚ùå SimpleHttpStrategy: –Ω–µ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç (–ø—Ä–æ–±–ª–µ–º–∞)
- ‚úÖ SafeOkHttpStrategy: —É–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
- üìã –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

## üõ°Ô∏è –ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- **TIMEOUT**: –°–µ—Ç–µ–≤—ã–µ —Ç–∞–π–º–∞—É—Ç—ã
- **FORBIDDEN**: –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ 403/401/429
- **NOT_FOUND**: –û—à–∏–±–∫–∏ 404
- **UNKNOWN_HOST**: DNS –ø—Ä–æ–±–ª–µ–º—ã
- **IO_ERROR**: –°–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏
- **ERROR**: –û–±—â–∏–µ –æ—à–∏–±–∫–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Fallback
1. SafeOkHttpStrategy (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 0)
2. SimpleHttpStrategy (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1) 
3. EnhancedHttpStrategy (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

## üìù –§–∞–π–ª—ã —Ä–µ—à–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã
- `SafeOkHttpStrategy.java` - –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è ‚≠ê
- `SimpleHttpStrategy.java` - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ enum —Å—Ç–∞—Ç—É—Å—ã
- `PageStatus.java` - Enum –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤
- `AntiBlockService.java` - –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –ª–æ–≥–∏–∫–∞ fallback

### –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã  
- `RedirectProblemDemoTest.java` - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã ‚≠ê
- `RedirectStrategiesIntegrationTest.java` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- `RedirectCollectorServiceTest.java` - Unit —Ç–µ—Å—Ç—ã

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `REDIRECT_STRATEGIES_GUIDE.md` - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `SOLUTION_SUMMARY.md` - –î–∞–Ω–Ω–∞—è —Å–≤–æ–¥–∫–∞

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Å goldapple.ru –ø–æ–ª–Ω–æ—Å—Ç—å—é –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∞ –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞**

‚úÖ **–°–æ–∑–¥–∞–Ω–∞ –Ω–∞–¥–µ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏**

‚úÖ **–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ PageStatus enum**

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ—à–µ–Ω–∏—è**

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ production —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º —Å—Ç—Ä–∞—Ç–µ–≥–∏–π!**
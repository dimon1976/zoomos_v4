# ะะพะบัะผะตะฝัะฐัะธั: ะะตะฐะปะธะทะฐัะธั ัะบัะฟะพััะฐ ััะฐัะธััะธะบะธ ะฒ Excel

**ะะฐัะฐ ัะตะฐะปะธะทะฐัะธะธ:** 2025-10-23
**Git commit:** `54ce88f` - feat: ัะตะฐะปะธะทะพะฒะฐัั ัะบัะฟะพัั ััะฐัะธััะธะบะธ ะฒ Excel (#3)
**ะกัะฐััั:** โ ะะฐะฒะตััะตะฝะพ ะธ ะฟัะพัะตััะธัะพะฒะฐะฝะพ ะบะพะผะฟะธะปััะธะตะน

---

## ะะฑะทะพั ะธะทะผะตะฝะตะฝะธะน

ะะตะฐะปะธะทะพะฒะฐะฝะฐ ะฟะพะปะฝะฐั ััะฝะบัะธะพะฝะฐะปัะฝะพััั ัะบัะฟะพััะฐ ััะฐัะธััะธะบะธ ััะฐะฒะฝะตะฝะธั ะฒ ัะพัะผะฐั Excel (.xlsx) ั ะฟะพะดะดะตัะถะบะพะน ะฒัะตั ัะธะปัััะพะฒ, ัะฒะตัะพะฒะพะณะพ ะบะพะดะธัะพะฒะฐะฝะธั ะธ ัะพัะผะฐัะธัะพะฒะฐะฝะธั ะดะฐะฝะฝัั.

**ะัะฝะพะฒะฝัะต ะฒะพะทะผะพะถะฝะพััะธ:**
- ะญะบัะฟะพัั ัะตะบััะตะน ััะฐัะธััะธะบะธ ะฒ Excel ัะฐะนะป
- ะกะพััะฐะฝะตะฝะธะต ะฒัะตั ะฟัะธะผะตะฝะตะฝะฝัั ัะธะปัััะพะฒ (ะฟะพ ะฟะพะปัะผ ะธ ะฟะพ ะผะตััะธะบะฐะผ)
- ะฆะฒะตัะพะฒะพะต ะบะพะดะธัะพะฒะฐะฝะธะต ััะตะตะบ ะฟะพ ััะพะฒะฝัะผ ะพัะบะปะพะฝะตะฝะธะน
- ะะฒัะพะผะฐัะธัะตัะบะฐั ัะธัะธะฝะฐ ะบะพะปะพะฝะพะบ ะธ ัะธะบัะฐัะธั ะทะฐะณะพะปะพะฒะบะพะฒ
- ะะพะดะดะตัะถะบะฐ ะฟัะพัะตะฝัะพะฒ ะพั ะพะฑัะตะณะพ (ะฟัะธ ัะธะปัััะฐัะธะธ)

---

## ะะฐััะพะฝัััะต ัะฐะนะปั

### 1. **ะะะะซะ ะคะะะ: StatisticsExcelExportService.java**

**ะััั:** `src/main/java/com/java/service/statistics/StatisticsExcelExportService.java`

**ะะฐะทะฝะฐัะตะฝะธะต:** ะกะฟะตัะธะฐะปะธะทะธัะพะฒะฐะฝะฝัะน ัะตัะฒะธั ะดะปั ะณะตะฝะตัะฐัะธะธ Excel ัะฐะนะปะพะฒ ัะพ ััะฐัะธััะธะบะพะน

**ะะปััะตะฒัะต ะบะพะผะฟะพะฝะตะฝัั:**

#### ะัะฝะพะฒะฝะพะน ะผะตัะพะด:
```java
public Path generateExcel(List<StatisticsComparisonDto> comparison, String clientName)
```
- **ะัะพะดะฝัะต ะฟะฐัะฐะผะตััั:**
  - `comparison` - ัะฟะธัะพะบ ะณััะฟะฟ ัะพ ััะฐัะธััะธะบะพะน (DTO)
  - `clientName` - ะธะผั ะบะปะธะตะฝัะฐ ะดะปั ะปะพะณะธัะพะฒะฐะฝะธั
- **ะะพะทะฒัะฐัะฐะตั:** Path ะบ ะฒัะตะผะตะฝะฝะพะผั Excel ัะฐะนะปั
- **ะัะบะปััะตะฝะธั:** IOException ะฟัะธ ะพัะธะฑะบะฐั ะทะฐะฟะธัะธ

#### ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ:
- **Apache POI:** ะัะฟะพะปัะทัะตั `SXSSFWorkbook` ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ ะฟะฐะผััะธ (window size = 100 ัััะพะบ)
- **ะกะถะฐัะธะต:** `workbook.setCompressTempFiles(true)` ะดะปั ัะบะพะฝะพะผะธะธ ะผะตััะฐ
- **ะกัะธะปะธ:** ะะฝัััะตะฝะฝะธะน ะบะปะฐัั `ExcelStyles` ั 12 ัะฐะทะปะธัะฝัะผะธ ััะธะปัะผะธ ะพัะพัะผะปะตะฝะธั

#### ะกัััะบัััะฐ Excel ัะฐะนะปะฐ:

**ะะฐะณะพะปะพะฒะบะธ (2 ัััะพะบะธ):**
- ะกััะพะบะฐ 1: "ะััะฟะฟะฐ" | "ะะตััะธะบะฐ" | "ะะฟะตัะฐัะธั #1 (ะดะฐัะฐ)" | "ะะฟะตัะฐัะธั #2 (ะดะฐัะฐ)" | ...
- ะกััะพะบะฐ 2: (ะฟัััะพ) | (ะฟัััะพ) | "ะะฐะทะฒะฐะฝะธะต ะพะฟะตัะฐัะธะธ 1" | "ะะฐะทะฒะฐะฝะธะต ะพะฟะตัะฐัะธะธ 2" | ...

**ะคะธะบัะฐัะธั:**
- ะะตัะฒัะต 2 ัััะพะบะธ (ะทะฐะณะพะปะพะฒะบะธ)
- ะะตัะฒัะต 2 ะบะพะปะพะฝะบะธ (ะััะฟะฟะฐ + ะะตััะธะบะฐ)
- ะะตะฐะปะธะทะพะฒะฐะฝะพ ัะตัะตะท: `sheet.createFreezePane(2, 2)`

**ะะฒัะพัะธะปััั:**
- ะัะธะผะตะฝัะตััั ะบะพ ะฒัะตะผั ะดะธะฐะฟะฐะทะพะฝั ะดะฐะฝะฝัั
- ะะพะทะฒะพะปัะตั ัะธะปัััะพะฒะฐัั ะฒ Excel ะฟะพ ะณััะฟะฟะฐะผ ะธ ะผะตััะธะบะฐะผ

#### ะฆะฒะตัะพะฒะพะต ะบะพะดะธัะพะฒะฐะฝะธะต (ะพะฟัะตะดะตะปัะตััั ะฒ `determineCellStyle()`):

| ะขะธะฟ ะธะทะผะตะฝะตะฝะธั | ะฃัะพะฒะตะฝั Alert | ะฆะฒะตั ัะพะฝะฐ | ะะพะฝััะฐะฝัะฐ POI |
|---------------|---------------|-----------|---------------|
| ะะพัั (UP) | WARNING | ะกะฒะตัะปะพ-ะทะตะปัะฝัะน | `LIGHT_GREEN` |
| ะะพัั (UP) | CRITICAL | ะฏัะบะพ-ะทะตะปัะฝัะน | `LIME` |
| ะะฐะดะตะฝะธะต (DOWN) | WARNING | ะกะฒะตัะปะพ-ะพัะฐะฝะถะตะฒัะน | `LIGHT_ORANGE` |
| ะะฐะดะตะฝะธะต (DOWN) | CRITICAL | ะะพัะฐะปะปะพะฒัะน | `CORAL` |
| ะกัะฐะฑะธะปัะฝะพ | - | ะะตะท ะทะฐะปะธะฒะบะธ | - |
| ะัะพะณะพะฒะฐั ัััะพะบะฐ | - | ะกะฒะตัะปะพ-ะถัะปััะน | `LIGHT_YELLOW` |

#### ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ะทะฝะฐัะตะฝะธะน (ะผะตัะพะด `formatMetricValue()`):

ะะฐะถะดะฐั ััะตะนะบะฐ ัะพะดะตัะถะธั ะดะพ 3 ัััะพะบ:
1. **ะขะตะบััะตะต ะทะฝะฐัะตะฝะธะต:** `1234`
2. **ะัะพัะตะฝั ะพั ะพะฑัะตะณะพ** (ะตัะปะธ ัะธะปััั ะฐะบัะธะฒะตะฝ): `(65.0% ะพั 1923)`
3. **ะะทะผะตะฝะตะฝะธะต:** `โ 15.5%` ะธะปะธ `โ 8.2%` ะธะปะธ `โ 0.0%`

#### ะจะธัะธะฝะฐ ะบะพะปะพะฝะพะบ (ะผะตัะพะด `autoSizeColumns()`):
- **ะะพะปะพะฝะบะฐ 0 (ะััะฟะฟะฐ):** ะคะธะบัะธัะพะฒะฐะฝะฝะฐั ัะธัะธะฝะฐ 30 ัะธะผะฒะพะปะพะฒ
- **ะะพะปะพะฝะบะฐ 1 (ะะตััะธะบะฐ):** ะคะธะบัะธัะพะฒะฐะฝะฝะฐั ัะธัะธะฝะฐ 25 ัะธะผะฒะพะปะพะฒ
- **ะััะฐะปัะฝัะต ะบะพะปะพะฝะบะธ:** ะะฒัะพะผะฐัะธัะตัะบะฐั ะฟะพะดัััะพะนะบะฐ + 10% ะทะฐะฟะฐัะฐ

---

### 2. **ะะะะะะะ: ExportStatisticsController.java**

**ะััั:** `src/main/java/com/java/controller/ExportStatisticsController.java`

**ะะทะผะตะฝะตะฝะธั:**

#### ะ) ะะพะฑะฐะฒะปะตะฝ import (ัััะพะบะฐ 15):
```java
import com.java.service.statistics.StatisticsExcelExportService;
```

#### ะ) ะะพะฑะฐะฒะปะตะฝะฐ ะทะฐะฒะธัะธะผะพััั ะฒ ะบะพะฝััััะบัะพั (ัััะพะบะฐ 43):
```java
private final StatisticsExcelExportService excelExportService;
```
- ะะฝะตะดััะตััั ัะตัะตะท Lombok `@RequiredArgsConstructor`
- Spring ะฐะฒัะพะผะฐัะธัะตัะบะธ ะธะฝะถะตะบัะธััะตั bean

#### ะ) ะะพะฒัะน endpoint (ัััะพะบะธ 467-513):

**URL:** `POST /statistics/export/excel`

**ะะฐัะฐะผะตััั ะทะฐะฟัะพัะฐ:**
- `@ModelAttribute StatisticsRequestDto request` - ะฟะฐัะฐะผะตััั ะฐะฝะฐะปะธะทะฐ
  - `templateId` - ID ัะฐะฑะปะพะฝะฐ ัะบัะฟะพััะฐ
  - `exportSessionIds` - ัะฟะธัะพะบ ID ัะตััะธะน ะดะปั ััะฐะฒะฝะตะฝะธั
  - `warningPercentage` - ะฟะพัะพะณ ะฟัะตะดัะฟัะตะถะดะตะฝะธั
  - `criticalPercentage` - ะฟะพัะพะณ ะบัะธัะธัะตัะบะพะณะพ ะพัะบะปะพะฝะตะฝะธั
- `@RequestParam String filterField` (optional) - ะฟะพะปะต ัะธะปัััะฐัะธะธ
- `@RequestParam String filterValue` (optional) - ะทะฝะฐัะตะฝะธะต ัะธะปัััะฐ
- `@RequestParam Long clientId` - ID ะบะปะธะตะฝัะฐ (ะพะฑัะทะฐัะตะปัะฝัะน)

**ะะพะณะธะบะฐ ัะฐะฑะพัั:**
```java
1. ะะพะปััะตะฝะธะต ะบะปะธะตะฝัะฐ ะธะท ะะ ะฟะพ clientId
2. ะัะทะพะฒ statisticsService.calculateComparison() ั ัะธะปัััะฐะผะธ
3. ะะฐะปะธะดะฐัะธั: ะตัะปะธ comparison.isEmpty() โ badRequest()
4. ะะตะฝะตัะฐัะธั Excel: excelExportService.generateExcel()
5. ะคะพัะผะธัะพะฒะฐะฝะธะต ะธะผะตะฝะธ ัะฐะนะปะฐ:
   statistics_{clientName}_{yyyyMMdd_HHmmss}.xlsx
6. ะะพะทะฒัะฐั ัะฐะนะปะฐ ั ะทะฐะณะพะปะพะฒะบะฐะผะธ:
   - Content-Disposition: attachment
   - Content-Type: application/octet-stream
```

**ะะฑัะฐะฑะพัะบะฐ ะพัะธะฑะพะบ:**
- ะัััะพะน ัะตะทัะปััะฐั โ HTTP 400 Bad Request
- ะัะบะปััะตะฝะธั โ HTTP 500 Internal Server Error
- ะะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพัะธะฑะพะบ ัะตัะตะท `log.error()`

**ะะพะทะฒัะฐัะฐะตะผัะน ัะธะฟ:**
```java
ResponseEntity<Resource>
```
- `FileSystemResource` ะดะปั ัะบะฐัะธะฒะฐะฝะธั ัะฐะนะปะฐ
- ะัะฐัะทะตั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฝะฐัะธะฝะฐะตั ะทะฐะณััะทะบั

---

### 3. **ะะะะะะะ: statistics/results.html**

**ะััั:** `src/main/resources/templates/statistics/results.html`

**ะะทะผะตะฝะตะฝะธั:**

#### ะ) ะะพะฑะฐะฒะปะตะฝะฐ ะณะปะพะฑะฐะปัะฝะฐั ะฟะตัะตะผะตะฝะฝะฐั clientId (ัััะพะบะฐ 697):

```javascript
const clientId = /*[[${clientId}]]*/ null;
```

**ะะฐะทะฝะฐัะตะฝะธะต:**
- Thymeleaf ะฟะพะดััะฐะฒะปัะตั ะทะฝะฐัะตะฝะธะต ะธะท ะผะพะดะตะปะธ ะบะพะฝััะพะปะปะตัะฐ
- ะัะฟะพะปัะทัะตััั ะฒ ััะฝะบัะธะธ `exportToExcel()` ะดะปั ะฟะตัะตะดะฐัะธ ะฝะฐ ัะตัะฒะตั
- ะะตะท ััะพะน ะฟะตัะตะผะตะฝะฝะพะน endpoint ะฒะตัะฝัั ะพัะธะฑะบั 400

**ะะตััะพ ะฒ ะบะพะดะต:**
- ะะฐัะพะดะธััั ะฒ ะฑะปะพะบะต `<script th:inline="javascript">`
- ะะพัะปะต ะดััะณะธั ะณะปะพะฑะฐะปัะฝัั ะฟะตัะตะผะตะฝะฝัั (templateId, sessionIds ะธ ั.ะด.)

#### ะ) ะะพะฒะฐั JavaScript ััะฝะบัะธั exportToExcel() (ัััะพะบะธ 1069-1120):

**ะะฐะทะฝะฐัะตะฝะธะต:** ะัะฟัะฐะฒะบะฐ POST-ะทะฐะฟัะพัะฐ ะฝะฐ ัะตัะฒะตั ะดะปั ะณะตะฝะตัะฐัะธะธ Excel ัะฐะนะปะฐ

**ะะปะณะพัะธัะผ ัะฐะฑะพัั:**

```javascript
function exportToExcel() {
    // 1. ะกะพะทะดะฐะฝะธะต ัะพัะผั ะดะปั POST-ะทะฐะฟัะพัะฐ
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = '/statistics/export/excel';

    // 2. ะัะฟะพะผะพะณะฐัะตะปัะฝะฐั ััะฝะบัะธั ะดะปั ะดะพะฑะฐะฒะปะตะฝะธั ัะบััััั ะฟะพะปะตะน
    const addHiddenField = (name, value) => {
        if (value !== null && value !== undefined) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = name;
            input.value = value;
            form.appendChild(input);
        }
    };

    // 3. ะะตัะตะดะฐัะฐ ะพะฑัะทะฐัะตะปัะฝัั ะฟะฐัะฐะผะตััะพะฒ
    addHiddenField('templateId', templateId);
    addHiddenField('clientId', clientId);

    // 4. ะะตัะตะดะฐัะฐ ะผะฐััะธะฒะฐ exportSessionIds
    if (sessionIds && sessionIds.length > 0) {
        sessionIds.forEach(id => {
            addHiddenField('exportSessionIds', id);
        });
    }

    // 5. ะะตัะตะดะฐัะฐ ะฟะพัะพะณะพะฒ ะฟัะตะดัะฟัะตะถะดะตะฝะธะน
    addHiddenField('warningPercentage', warningThresholdFromTemplate);
    addHiddenField('criticalPercentage', criticalThresholdFromTemplate);

    // 6. ะะตัะตะดะฐัะฐ ะฐะบัะธะฒะฝะพะณะพ ัะธะปัััะฐ (ะตัะปะธ ะตััั)
    if (activeFilterField && activeFilterValue) {
        addHiddenField('filterField', activeFilterField);
        addHiddenField('filterValue', activeFilterValue);
    }

    // 7. ะัะฟัะฐะฒะบะฐ ัะพัะผั
    document.body.appendChild(form);
    form.submit();

    // 8. ะฃะดะฐะปะตะฝะธะต ัะพัะผั ัะตัะตะท 100ms
    setTimeout(() => {
        document.body.removeChild(form);
    }, 100);
}
```

**ะัะพะฑะตะฝะฝะพััะธ ัะตะฐะปะธะทะฐัะธะธ:**

1. **POST ะฒะผะตััะพ GET:**
   - ะัะฟะพะปัะทัะตััั POST ะดะปั ะฟะตัะตะดะฐัะธ ะผะฐััะธะฒะพะฒ ะธ ะฑะพะปััะธั ะฟะฐัะฐะผะตััะพะฒ
   - GET ะธะผะตะตั ะพะณัะฐะฝะธัะตะฝะธะต ะฝะฐ ะดะปะธะฝั URL (2048 ัะธะผะฒะพะปะพะฒ)

2. **ะะธะฝะฐะผะธัะตัะบะพะต ัะพะทะดะฐะฝะธะต ัะพัะผั:**
   - ะะต ััะตะฑัะตั ะธะทะผะตะฝะตะฝะธะน ะฒ HTML ัะฐะทะผะตัะบะต
   - ะคะพัะผะฐ ัะพะทะดะฐัััั ะธ ัะดะฐะปัะตััั ะฝะฐ ะปะตัั

3. **ะะพะดะดะตัะถะบะฐ ะผะฐััะธะฒะพะฒ:**
   - `sessionIds` ะฟะตัะตะดะฐัััั ะบะฐะบ ะฝะตัะบะพะปัะบะพ ะฟะพะปะตะน ั ะพะดะธะฝะฐะบะพะฒัะผ ะธะผะตะฝะตะผ
   - Spring ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะพะฑะธัะฐะตั ะธั ะฒ `List<Long>`

4. **ะกะพััะฐะฝะตะฝะธะต ัะพััะพัะฝะธั:**
   - ะะตัะตะดะฐัััั ะฒัะต ัะตะบััะธะต ะฟะฐัะฐะผะตััั ัััะฐะฝะธัั
   - ะญะบัะฟะพัั ัะพะพัะฒะตัััะฒัะตั ะพัะพะฑัะฐะถะฐะตะผัะผ ะดะฐะฝะฝัะผ

**ะัะธะฒัะทะบะฐ ะบ UI:**
ะคัะฝะบัะธั ะฒัะทัะฒะฐะตััั ะธะท ะดะฒัั ะผะตัั ะฒ HTML:
1. **ะะฝะพะฟะบะฐ ะฒ header** (ัััะพะบะฐ 298):
   ```html
   <button onclick="exportToExcel()">
       <i class="fas fa-file-excel"></i>ะญะบัะฟะพัั ะฒ Excel
   </button>
   ```

2. **ะะปะฐะฒะฐััะฐั ะบะฝะพะฟะบะฐ** (ัััะพะบะฐ 681):
   ```html
   <button onclick="exportToExcel()" title="ะญะบัะฟะพัั ะฒ Excel">
       <i class="fas fa-file-excel fa-lg"></i>
   </button>
   ```

---

## ะััะธัะตะบัััะฐ ัะตัะตะฝะธั

### ะะพัะพะบ ะดะฐะฝะฝัั:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 1. USER: ะะฐะถะธะผะฐะตั ะบะฝะพะฟะบั "ะญะบัะฟะพัั ะฒ Excel"                  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 2. BROWSER: exportToExcel() ัะพะทะดะฐัั ะธ ะพัะฟัะฐะฒะปัะตั POST ัะพัะผั โ
โ    - templateId, clientId, sessionIds                        โ
โ    - warningPercentage, criticalPercentage                   โ
โ    - filterField, filterValue (ะตัะปะธ ัะธะปััั ะฐะบัะธะฒะตะฝ)          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 3. CONTROLLER: ExportStatisticsController.exportToExcel()   โ
โ    - ะะพะปััะฐะตั ะบะปะธะตะฝัะฐ ะธะท ะะ                                  โ
โ    - ะัะทัะฒะฐะตั ExportStatisticsService.calculateComparison() โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 4. SERVICE: ExportStatisticsService                          โ
โ    - ะะฐะณััะถะฐะตั ััะฐัะธััะธะบั ะธะท ะะ                              โ
โ    - ะัะธะผะตะฝัะตั ัะธะปัััั                                       โ
โ    - ะััะธัะปัะตั ะพัะบะปะพะฝะตะฝะธั ะธ alert levels                     โ
โ    - ะะพะทะฒัะฐัะฐะตั List<StatisticsComparisonDto>                โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 5. EXCEL SERVICE: StatisticsExcelExportService               โ
โ    - ะกะพะทะดะฐัั SXSSFWorkbook                                   โ
โ    - ะะตะฝะตัะธััะตั ะทะฐะณะพะปะพะฒะบะธ (2 ัััะพะบะธ)                         โ
โ    - ะะฐะฟะธััะฒะฐะตั ะดะฐะฝะฝัะต ะณััะฟะฟะฐะผะธ                              โ
โ    - ะัะธะผะตะฝัะตั ััะธะปะธ ะธ ัะฒะตัะพะฒะพะต ะบะพะดะธัะพะฒะฐะฝะธะต                  โ
โ    - ะะฐัััะฐะธะฒะฐะตั ัะธัะธะฝั ะบะพะปะพะฝะพะบ                              โ
โ    - ะกะพััะฐะฝัะตั ะฒะพ ะฒัะตะผะตะฝะฝัะน ัะฐะนะป                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 6. CONTROLLER: ะคะพัะผะธััะตั ResponseEntity                      โ
โ    - ะกะพะทะดะฐัั FileSystemResource                              โ
โ    - ะฃััะฐะฝะฐะฒะปะธะฒะฐะตั ะทะฐะณะพะปะพะฒะพะบ Content-Disposition             โ
โ    - ะะพะทะฒัะฐัะฐะตั ัะฐะนะป ะบะปะธะตะฝัั                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ 7. BROWSER: ะะฐัะธะฝะฐะตั ะทะฐะณััะทะบั ัะฐะนะปะฐ                         โ
โ    - ะคะฐะนะป: statistics_{client}_{timestamp}.xlsx             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ะะฐะฒะธัะธะผะพััะธ ะผะตะถะดั ะบะพะผะฟะพะฝะตะฝัะฐะผะธ:

```
ExportStatisticsController
    โโโ ExportStatisticsService (ัััะตััะฒัััะธะน)
    โ   โโโ ExportStatisticsRepository
    โ   โโโ ExportSessionRepository
    โ   โโโ ExportTemplateRepository
    โ
    โโโ StatisticsExcelExportService (ะะะะซะ)
        โโโ PathResolver (ัััะตััะฒัััะธะน ัะตัะฒะธั)
```

---

## ะขะตัะฝะธัะตัะบะธะต ะดะตัะฐะปะธ ัะตะฐะปะธะทะฐัะธะธ

### 1. ะัะฟะพะปัะทะพะฒะฐะฝะธะต Apache POI

**ะัะฑะพั SXSSFWorkbook:**
- Streaming API ะดะปั ะฑะพะปััะธั ัะฐะนะปะพะฒ
- ะัะฟะพะปัะทัะตั ะฒัะตะผะตะฝะฝัะต ัะฐะนะปั ะฒะผะตััะพ RAM
- Window size = 100 ัััะพะบ (ัะพะปัะบะพ 100 ัััะพะบ ะฒ ะฟะฐะผััะธ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ)
- ะะฒัะพะผะฐัะธัะตัะบะพะต ัะดะฐะปะตะฝะธะต ัะตัะตะท `workbook.dispose()`

**ะะปััะตัะฝะฐัะธะฒั ะธ ะฟะพัะตะผั ะฝะต ะฒัะฑัะฐะฝั:**
- `XSSFWorkbook` - ะฒะตัั ัะฐะนะป ะฒ ะฟะฐะผััะธ (ัะธัะบ OutOfMemoryError)
- `HSSFWorkbook` - ัััะฐัะตะฒัะธะน ัะพัะผะฐั .xls (ะพะณัะฐะฝะธัะตะฝะธะต 65536 ัััะพะบ)

### 2. ะฆะฒะตัะพะฒะพะต ะบะพะดะธัะพะฒะฐะฝะธะต

**ะะพะณะธะบะฐ ะพะฟัะตะดะตะปะตะฝะธั ัะฒะตัะฐ (ะผะตัะพะด `determineCellStyle()`):**

```java
if (isTotalSummary) {
    return totalValueStyle; // ะัะตะณะดะฐ ะถัะปััะน ะดะปั ะธัะพะณะพะฒ
}

if (previousValue == null || changeType == STABLE) {
    return normalStyle; // ะะตั ะธะทะผะตะฝะตะฝะธะน = ะฑะตะท ัะฒะตัะฐ
}

if (changeType == UP) {
    return alertLevel == WARNING ? increaseWarningStyle : increaseCriticalStyle;
} else { // DOWN
    return alertLevel == WARNING ? decreaseWarningStyle : decreaseCriticalStyle;
}
```

**ะะฐะถะฝะพ:** ะะปั ะผะตััะธะบะธ DATE_MODIFICATIONS ะปะพะณะธะบะฐ ะธะฝะฒะตััะธัะพะฒะฐะฝะฐ ะฒ HTML, ะฝะพ ะฒ Excel ัะบัะฟะพััะธััะตััั ะบะฐะบ ะตััั.

### 3. ะะฑัะฐะฑะพัะบะฐ ัะธะปัััะพะฒ

**ะะพะดะดะตัะถะธะฒะฐะตะผัะต ัะธะฟั ัะธะปัััะพะฒ:**

1. **ะคะธะปััั ะฟะพ ะฟะพะปัะผ ะดะฐะฝะฝัั:**
   - `filterField` + `filterValue` (ะฝะฐะฟัะธะผะตั: "competitorStockStatus" = "ะ ะฝะฐะปะธัะธะธ")
   - ะะตัะตะดะฐัััั ะฒ `ExportStatisticsService.calculateComparison()`
   - Excel ะฟะพะบะฐะทัะฒะฐะตั ัะพะปัะบะพ ะพััะธะปัััะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต

2. **ะคะธะปััั ะฟะพ ะผะตััะธะบะฐะผ:**
   - ะะต ะฟัะธะผะตะฝัะตััั ะบ Excel ัะบัะฟะพััั
   - ะะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ัะธะปัััะพะฒะฐัั ัะถะต ะฒ Excel ัะตัะตะท ะฐะฒัะพัะธะปััั

3. **ะะพัะพะณะธ ะฟัะตะดัะฟัะตะถะดะตะฝะธะน:**
   - `warningPercentage` ะธ `criticalPercentage`
   - ะะปะธััั ะฝะฐ ัะฒะตัะพะฒะพะต ะบะพะดะธัะพะฒะฐะฝะธะต ััะตะตะบ

### 4. ะคะพัะผะฐัะธัะพะฒะฐะฝะธะต ััะตะตะบ

**ะะฝะพะณะพัััะพัะฝัะต ะทะฝะฐัะตะฝะธั:**
- ะัะฟะพะปัะทัะตััั `\n` ะดะปั ัะฐะทะดะตะปะตะฝะธั ัััะพะบ
- ะกัะธะปั ััะตะนะบะธ ะธะผะตะตั `setWrapText(true)`
- Excel ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟะพะดัััะฐะธะฒะฐะตั ะฒััะพัั ัััะพะบะธ

**ะัะธะผะตั ัะพัะผะฐัะธัะพะฒะฐะฝะธั:**
```
1234
(65.0% ะพั 1923)
โ 15.5%
```

**Unicode ัะธะผะฒะพะปั ะดะปั ัััะตะปะพะบ:**
- `โ` (U+2191) - ัะพัั
- `โ` (U+2193) - ะฟะฐะดะตะฝะธะต
- `โ` (U+2212) - ััะฐะฑะธะปัะฝะพ (ะผะธะฝัั, ะฝะต ะดะตัะธั!)

### 5. ะะฟัะธะผะธะทะฐัะธั ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

**ะะฐะผััั:**
- SXSSFWorkbook ะดะตัะถะธั ะฒ ะฟะฐะผััะธ ัะพะปัะบะพ 100 ัััะพะบ
- ะัะตะผะตะฝะฝัะต ัะฐะนะปั ัะถะธะผะฐัััั (`setCompressTempFiles(true)`)
- `workbook.dispose()` ะณะฐัะฐะฝัะธััะตั ัะดะฐะปะตะฝะธะต ะฒัะตะผะตะฝะฝัั ัะฐะนะปะพะฒ

**ะกะบะพัะพััั:**
- ะกัะธะปะธ ัะพะทะดะฐัััั ะพะดะธะฝ ัะฐะท ะฒ `createStyles()`
- ะะตัะตะธัะฟะพะปัะทััััั ะดะปั ะฒัะตั ััะตะตะบ (ะฝะต ัะพะทะดะฐัะผ ะฝะพะฒัะต ััะธะปะธ)
- AutoSize ะฒัะทัะฒะฐะตััั ัะพะปัะบะพ ะฟะพัะปะต ะทะฐะฟะธัะธ ะฒัะตั ะดะฐะฝะฝัั

**ะะฐะผััั ะฝะฐ ััะพัะพะฝะต ัะตัะฒะตัะฐ:**
- ะคะฐะนะป ัะพะทะดะฐัััั ะฒะพ ะฒัะตะผะตะฝะฝะพะน ะดะธัะตะบัะพัะธะธ
- PathResolver ัะฟัะฐะฒะปัะตั ะฟัััะผะธ (ัััะตััะฒัััะธะน ัะตัะฒะธั)
- Spring ะฐะฒัะพะผะฐัะธัะตัะบะธ ัะดะฐะปัะตั ัะฐะนะป ะฟะพัะปะต ะพัะฟัะฐะฒะบะธ ะบะปะธะตะฝัั

---

## ะขะตััะธัะพะฒะฐะฝะธะต

### ะะพะผะฟะธะปััะธั

โ **ะฃัะฟะตัะฝะพ ัะบะพะผะฟะธะปะธัะพะฒะฐะฝะพ:**
```bash
mvn clean compile -q
```

**ะัะพะฒะตัะตะฝะพ:**
- ะัะต imports ะฟัะธัััััะฒััั
- StatisticsExcelExportService ะฝะฐะนะดะตะฝ Spring ะบะพะฝัะตะนะฝะตัะพะผ
- ะะตั ัะธะฝัะฐะบัะธัะตัะบะธั ะพัะธะฑะพะบ

### ะงัะพ ะฝัะถะฝะพ ะฟัะพัะตััะธัะพะฒะฐัั ะฒัััะฝัั:

1. **ะะฐะทะพะฒัะน ัะบัะฟะพัั:**
   - [ ] ะัะบัััั ัััะฐะฝะธัั ััะฐัะธััะธะบะธ
   - [ ] ะัะฑัะฐัั ะฝะตัะบะพะปัะบะพ ะพะฟะตัะฐัะธะน
   - [ ] ะะฐะถะฐัั "ะญะบัะฟะพัั ะฒ Excel"
   - [ ] ะัะพะฒะตัะธัั: ัะฐะนะป ัะบะฐัะธะฒะฐะตััั ั ะบะพััะตะบัะฝัะผ ะธะผะตะฝะตะผ
   - [ ] ะัะบัััั ะฒ Excel: ะดะฐะฝะฝัะต ะบะพััะตะบัะฝั, ัะพัะผะฐัะธัะพะฒะฐะฝะธะต ะฟัะธะผะตะฝะตะฝะพ

2. **ะญะบัะฟะพัั ั ัะธะปัััะพะผ ะฟะพ ะฟะพะปัะผ:**
   - [ ] ะัะธะผะตะฝะธัั ัะธะปััั (ะฝะฐะฟัะธะผะตั, "ะ ะฝะฐะปะธัะธะธ")
   - [ ] ะะฐะถะฐัั "ะญะบัะฟะพัั ะฒ Excel"
   - [ ] ะัะพะฒะตัะธัั: ัะพะปัะบะพ ะพััะธะปัััะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต ะฒ ัะฐะนะปะต
   - [ ] ะัะพะฒะตัะธัั: ะพัะพะฑัะฐะถะฐัััั ะฟัะพัะตะฝัั ะพั ะพะฑัะตะณะพ

3. **ะญะบัะฟะพัั ั ะธะทะผะตะฝัะฝะฝัะผะธ ะฟะพัะพะณะฐะผะธ:**
   - [ ] ะะทะผะตะฝะธัั ะฟะพัะพะณะธ warning/critical
   - [ ] ะัะธะผะตะฝะธัั
   - [ ] ะะฐะถะฐัั "ะญะบัะฟะพัั ะฒ Excel"
   - [ ] ะัะพะฒะตัะธัั: ัะฒะตัะพะฒะพะต ะบะพะดะธัะพะฒะฐะฝะธะต ัะพะพัะฒะตัััะฒัะตั ะฝะพะฒัะผ ะฟะพัะพะณะฐะผ

4. **ะะพะปััะธะต ะพะฑััะผั ะดะฐะฝะฝัั:**
   - [ ] ะัะฑัะฐัั 10+ ะพะฟะตัะฐัะธะน ั ะฑะพะปััะธะผ ะบะพะปะธัะตััะฒะพะผ ะณััะฟะฟ
   - [ ] ะญะบัะฟะพััะธัะพะฒะฐัั
   - [ ] ะัะพะฒะตัะธัั: ะฝะตั ะพัะธะฑะพะบ OutOfMemoryError
   - [ ] ะัะพะฒะตัะธัั: ัะฐะนะป ะพัะบััะฒะฐะตััั ะฒ Excel ะฑะตะท ะทะฐะฒะธัะฐะฝะธะน

5. **ะะพััะตะบัะฝะพััั ะดะฐะฝะฝัั:**
   - [ ] ะกัะฐะฒะฝะธัั ะดะฐะฝะฝัะต ะฒ ะฑัะฐัะทะตัะต ะธ Excel
   - [ ] ะัะพะฒะตัะธัั: ะทะฝะฐัะตะฝะธั ะผะตััะธะบ ัะพะฒะฟะฐะดะฐัั
   - [ ] ะัะพะฒะตัะธัั: ะฟัะพัะตะฝัั ะธะทะผะตะฝะตะฝะธะน ัะพะฒะฟะฐะดะฐัั
   - [ ] ะัะพะฒะตัะธัั: ัะฒะตัะพะฒะพะต ะบะพะดะธัะพะฒะฐะฝะธะต ัะพะฒะฟะฐะดะฐะตั

6. **ะกะฟะตัะธะฐะปัะฝัะต ัะธะผะฒะพะปั:**
   - [ ] ะะปะธะตะฝั ั ะธะผะตะฝะตะผ ัะพะดะตัะถะฐัะธะผ ัะฟะตััะธะผะฒะพะปั (ะฟัะพะฑะตะปั, ะบะธัะธะปะปะธัะฐ)
   - [ ] ะัะพะฒะตัะธัั: ะธะผั ัะฐะนะปะฐ ะบะพััะตะบัะฝะพ ััะพัะผะธัะพะฒะฐะฝะพ
   - [ ] ะัะพะฒะตัะธัั: ัะฐะนะป ัะบะฐัะธะฒะฐะตััั ะฑะตะท ะพัะธะฑะพะบ

7. **ะััััะต ะดะฐะฝะฝัะต:**
   - [ ] ะะพะฟัะพะฑะพะฒะฐัั ัะบัะฟะพัั ะฑะตะท ะฒัะฑัะฐะฝะฝัั ะพะฟะตัะฐัะธะน
   - [ ] ะะถะธะดะฐะตะผะพะต ะฟะพะฒะตะดะตะฝะธะต: ะพัะธะฑะบะฐ ะธะปะธ ะฟัะตะดัะฟัะตะถะดะตะฝะธะต

---

## ะะพัะตะฝัะธะฐะปัะฝัะต ะฟัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั

### ะัะพะฑะปะตะผะฐ 1: OutOfMemoryError ะฟัะธ ะฑะพะปััะพะผ ะบะพะปะธัะตััะฒะต ะณััะฟะฟ

**ะกะธะผะฟัะพะผั:**
- ะัะธะฑะบะฐ ะฟัะธ ัะบัะฟะพััะต > 1000 ะณััะฟะฟ
- ะกะตัะฒะตั ะฟะฐะดะฐะตั ั java.lang.OutOfMemoryError

**ะะตัะตะฝะธะต:**
- SXSSFWorkbook ัะถะต ะธัะฟะพะปัะทัะตััั (window size = 100)
- ะะพะถะฝะพ ัะผะตะฝััะธัั window size ะดะพ 50
- ะะพะฑะฐะฒะธัั ะปะธะผะธั ะฝะฐ ะบะพะปะธัะตััะฒะพ ัััะพะบ (ะฝะฐะฟัะธะผะตั, max 10000)

**ะะดะต ะฟัะฐะฒะธัั:**
```java
// ะคะฐะนะป: StatisticsExcelExportService.java, ัััะพะบะฐ 47
try (SXSSFWorkbook workbook = new SXSSFWorkbook(50); // ะัะปะพ 100
```

### ะัะพะฑะปะตะผะฐ 2: ะะตะบะพััะตะบัะฝัะต ััััะบะธะต ัะธะผะฒะพะปั ะฒ ะธะผะตะฝะธ ัะฐะนะปะฐ

**ะกะธะผะฟัะพะผั:**
- ะคะฐะนะป ัะบะฐัะธะฒะฐะตััั ะบะฐะบ "statistics_____20251023.xlsx"
- ะัััะบะธะต ะฑัะบะฒั ะทะฐะผะตะฝะตะฝั ะฝะฐ ะฟะพะดัััะบะธะฒะฐะฝะธั

**ะัะธัะธะฝะฐ:**
- `replaceAll("[^a-zA-Z0-9ะฐ-ัะ-ะฏ]", "_")` ะผะพะถะตั ะฝะต ัะฐะฑะพัะฐัั ะฒ ะฝะตะบะพัะพััั ะปะพะบะฐะปัั

**ะะตัะตะฝะธะต:**
```java
// ะคะฐะนะป: ExportStatisticsController.java, ัััะพะบะฐ 496
String fileName = String.format("statistics_%s_%s.xlsx",
    URLEncoder.encode(client.getName(), StandardCharsets.UTF_8)
        .replaceAll("\\+", "_"),
    LocalDateTime.now().format(DateTimeFormatter.ofPattern("yyyyMMdd_HHmmss")));
```

### ะัะพะฑะปะตะผะฐ 3: Excel ะฝะต ะพัะบััะฒะฐะตั ัะฐะนะป (ะพัะธะฑะบะฐ ัะพัะผะฐัะฐ)

**ะกะธะผะฟัะพะผั:**
- Excel ะฟะพะบะฐะทัะฒะฐะตั: "ะคะพัะผะฐั ัะฐะนะปะฐ ะฝะต ัะพะพัะฒะตัััะฒัะตั ัะฐััะธัะตะฝะธั"
- ะคะฐะนะป ะฝะต ะพัะบััะฒะฐะตััั

**ะะพะทะผะพะถะฝัะต ะฟัะธัะธะฝั:**
1. `workbook.write()` ะฝะต ะฒัะทะฒะฐะฝ ะธะปะธ ะฟัะตัะฒะฐะฝ
2. `workbook.dispose()` ะฒัะทะฒะฐะฝ ะดะพ ะทะฐะฒะตััะตะฝะธั ะทะฐะฟะธัะธ
3. ะคะฐะนะป ะฟะพะฒัะตะถะดัะฝ ะฝะฐ ะดะธัะบะต

**ะะดะต ะฟัะพะฒะตัะธัั:**
```java
// ะคะฐะนะป: StatisticsExcelExportService.java, ัััะพะบะธ 60-65
workbook.write(fos); // ะะพะปะถะฝะพ ะฒัะฟะพะปะฝะธัััั
workbook.dispose();  // ะขะพะปัะบะพ ะฟะพัะปะต write()
```

**ะัะปะฐะดะบะฐ:**
- ะะพะฑะฐะฒะธัั ะปะพะณะธัะพะฒะฐะฝะธะต ะฟะตัะตะด/ะฟะพัะปะต `workbook.write()`
- ะัะพะฒะตัะธัั ัะฐะทะผะตั ัะฐะนะปะฐ (ะฝะต ะดะพะปะถะตะฝ ะฑััั 0 ะฑะฐะนั)

### ะัะพะฑะปะตะผะฐ 4: ะะตะดะปะตะฝะฝะฐั ะณะตะฝะตัะฐัะธั (> 30 ัะตะบัะฝะด)

**ะกะธะผะฟัะพะผั:**
- ะะพะปัะทะพะฒะฐัะตะปั ะดะพะปะณะพ ะถะดัั ะฝะฐัะฐะปะฐ ะทะฐะณััะทะบะธ
- Timeout ะฝะฐ ััะพัะพะฝะต ัะตัะฒะตัะฐ ะธะปะธ ะบะปะธะตะฝัะฐ

**ะัะธัะธะฝั:**
- ะกะปะธัะบะพะผ ะผะฝะพะณะพ ะพะฟะตัะฐัะธะน ะดะปั ััะฐะฒะฝะตะฝะธั (> 20)
- ะะพะปััะพะต ะบะพะปะธัะตััะฒะพ ะณััะฟะฟ (> 1000)
- ะัะทะพะฒ `autoSizeColumn()` ะดะปั ะฒัะตั ะบะพะปะพะฝะพะบ

**ะะฟัะธะผะธะทะฐัะธั:**
```java
// ะคะฐะนะป: StatisticsExcelExportService.java, ะผะตัะพะด autoSizeColumns()

// ะะฐัะธะฐะฝั 1: ะัะบะปััะธัั autoSize ะดะปั ะพะฟะตัะฐัะธะน
if (col < 2) {
    // ะขะพะปัะบะพ ะดะปั ะฟะตัะฒัั ะดะฒัั ะบะพะปะพะฝะพะบ
}

// ะะฐัะธะฐะฝั 2: ะะณัะฐะฝะธัะธัั ะฐะฝะฐะปะธะท ะฟะตัะฒัะผะธ N ัััะพะบะฐะผะธ
// sheet.trackColumnForAutoSizing(col);
// sheet.trackColumnsForAutoSizing(Arrays.asList(0, 1, 2));
```

---

## ะะพะทะผะพะถะฝัะต ัะปัััะตะฝะธั (ะฝะต ัะตะฐะปะธะทะพะฒะฐะฝะพ)

### 1. ะัะธะฝััะพะฝะฝะฐั ะณะตะฝะตัะฐัะธั ะดะปั ะฑะพะปััะธั ัะฐะนะปะพะฒ

**ะขะตะบััะฐั ะฟัะพะฑะปะตะผะฐ:**
- ะะพะปัะทะพะฒะฐัะตะปั ะถะดัั ะณะตะฝะตัะฐัะธั ัะฐะนะปะฐ
- ะะปะพะบะธัะพะฒะบะฐ HTTP ัะพะตะดะธะฝะตะฝะธั

**ะะตัะตะฝะธะต:**
- ะัะฟะพะปัะทะพะฒะฐัั AsyncExportService
- ะะตะฝะตัะธัะพะฒะฐัั ัะฐะนะป ะฒ ัะพะฝะต
- WebSocket ัะฒะตะดะพะผะปะตะฝะธะต ะพ ะณะพัะพะฒะฝะพััะธ
- ะกะบะฐัะธะฒะฐะฝะธะต ัะตัะตะท ะพัะดะตะปัะฝัะน endpoint

**ะคะฐะนะปั ะดะปั ะธะทะผะตะฝะตะฝะธั:**
- ะกะพะทะดะฐัั `AsyncStatisticsExportService`
- ะะพะฑะฐะฒะธัั endpoint `GET /statistics/download/{operationId}`
- ะะพะฑะฐะฒะธัั WebSocket ัะพะฟะธะบ `/topic/statistics-export/{operationId}`

### 2. ะะฐััะพะผะธะทะฐัะธั ััะธะปะตะน ัะตัะตะท ะฝะฐัััะพะนะบะธ

**ะะดะตั:**
- ะะพะทะฒะพะปะธัั ะฟะพะปัะทะพะฒะฐัะตะปั ะฒัะฑะธัะฐัั ัะฒะตัะฐ
- ะกะพััะฐะฝััั ะฟัะตะดะฟะพััะตะฝะธั ะฒ ะฟัะพัะธะปะต

**ะคะฐะนะปั ะดะปั ะธะทะผะตะฝะตะฝะธั:**
- ะะพะฑะฐะฒะธัั ะฟะพะปั ะฒ `StatisticsSettings`
- ะะตัะตะดะฐะฒะฐัั ัะฒะตัะฐ ะฒ `createStyles()`

### 3. ะญะบัะฟะพัั ะฒ ะดััะณะธะต ัะพัะผะฐัั (PDF, CSV)

**CSV:**
- ะัะพััะฐั ัะตะฐะปะธะทะฐัะธั ัะตัะตะท `FileGeneratorService`
- ะะตั ัะฒะตัะพะฒะพะณะพ ะบะพะดะธัะพะฒะฐะฝะธั

**PDF:**
- ะัะฟะพะปัะทะพะฒะฐัั Apache PDFBox ะธะปะธ iText
- ะกะพััะฐะฝะธัั ัะฐะฑะปะธัั ั ัะพัะผะฐัะธัะพะฒะฐะฝะธะตะผ

### 4. ะะพะฑะฐะฒะปะตะฝะธะต ะณัะฐัะธะบะพะฒ ะฒ Excel

**ะะดะตั:**
- ะัััะพะตะฝะฝัะต ะณัะฐัะธะบะธ ััะตะฝะดะพะฒ ะดะปั ะบะฐะถะดะพะน ะณััะฟะฟั
- ะัะฟะพะปัะทัั Apache POI Drawing API

**ะกะปะพะถะฝะพััั:**
- ะััะพะบะฐั (API ัะปะพะถะฝัะน)
- ะฃะฒะตะปะธัะตะฝะธะต ัะฐะทะผะตัะฐ ัะฐะนะปะฐ

---

## Checklist ะดะปั ะฟัะพะฒะตัะบะธ

### ะคัะฝะบัะธะพะฝะฐะปัะฝะพััั
- [ ] ะะฝะพะฟะบะฐ "ะญะบัะฟะพัั ะฒ Excel" ัะฐะฑะพัะฐะตั (ะฒ header ะธ ะฟะปะฐะฒะฐััะฐั)
- [ ] ะคะฐะนะป ัะบะฐัะธะฒะฐะตััั ั ะบะพััะตะบัะฝัะผ ะธะผะตะฝะตะผ
- [ ] ะคะฐะนะป ะพัะบััะฒะฐะตััั ะฒ Microsoft Excel / LibreOffice Calc
- [ ] ะะฐะฝะฝัะต ัะพะพัะฒะตัััะฒััั ะพัะพะฑัะฐะถะฐะตะผัะผ ะฝะฐ ัััะฐะฝะธัะต
- [ ] ะฆะฒะตัะพะฒะพะต ะบะพะดะธัะพะฒะฐะฝะธะต ะบะพััะตะบัะฝะพ
- [ ] ะะฐะณะพะปะพะฒะบะธ ะทะฐัะธะบัะธัะพะฒะฐะฝั (ะผะพะถะฝะพ ะฟัะพะบัััะธะฒะฐัั ะดะฐะฝะฝัะต)
- [ ] ะะฒัะพัะธะปััั ัะฐะฑะพัะฐะตั

### ะคะธะปัััั
- [ ] ะญะบัะฟะพัั ะฑะตะท ัะธะปัััะฐ: ะฒัะต ะณััะฟะฟั
- [ ] ะญะบัะฟะพัั ั ัะธะปัััะพะผ ะฟะพ ะฟะพะปั: ัะพะปัะบะพ ะพััะธะปัััะพะฒะฐะฝะฝัะต ะดะฐะฝะฝัะต
- [ ] ะัะพัะตะฝัั ะพั ะพะฑัะตะณะพ ะพัะพะฑัะฐะถะฐัััั (ะฟัะธ ัะธะปัััะฐัะธะธ)
- [ ] ะะพัะพะณะธ warning/critical ะฟัะธะผะตะฝััััั ะบ ัะฒะตัะฐะผ

### Edge cases
- [ ] ะญะบัะฟะพัั ั ะพะดะฝะพะน ะพะฟะตัะฐัะธะตะน
- [ ] ะญะบัะฟะพัั ั > 10 ะพะฟะตัะฐัะธะน
- [ ] ะะปะธะตะฝั ั ะบะธัะธะปะปะธัะตะน ะฒ ะธะผะตะฝะธ
- [ ] ะะปะธะตะฝั ั ะฟัะพะฑะตะปะฐะผะธ ะธ ัะฟะตััะธะผะฒะพะปะฐะผะธ ะฒ ะธะผะตะฝะธ
- [ ] ะัััะพะน ัะตะทัะปััะฐั (ะฝะตั ะดะฐะฝะฝัั) - ะดะพะปะถะฝะฐ ะฑััั ะพัะธะฑะบะฐ

### ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั
- [ ] ะญะบัะฟะพัั < 100 ะณััะฟะฟ: < 5 ัะตะบัะฝะด
- [ ] ะญะบัะฟะพัั 100-500 ะณััะฟะฟ: < 15 ัะตะบัะฝะด
- [ ] ะญะบัะฟะพัั > 500 ะณััะฟะฟ: ะฟัะธะตะผะปะตะผะพะต ะฒัะตะผั ะธะปะธ async ัะตะถะธะผ

### ะะตะทะพะฟะฐัะฝะพััั
- [ ] ะะตะดะพัััะฟะตะฝ ะฑะตะท ะฐะฒัะพัะธะทะฐัะธะธ (ะตัะปะธ ะตััั Security)
- [ ] clientId ะฒะฐะปะธะดะธััะตััั (ะบะปะธะตะฝั ัััะตััะฒัะตั)
- [ ] ะะตั SQL ะธะฝัะตะบัะธะน ะฒ ะฟะฐัะฐะผะตััะฐั ัะธะปัััะฐ
- [ ] ะัะตะผะตะฝะฝัะน ัะฐะนะป ัะดะฐะปัะตััั ะฟะพัะปะต ัะบะฐัะธะฒะฐะฝะธั

---

## ะะพะฝัะฐะบัั ะดะปั ะฒะพะฟัะพัะพะฒ

**ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ ะฟัะพะฒะตัะธัั:**
1. ะะพะณะธ Spring Boot (ะฟะพะธัะบ ะฟะพ "Statistics Excel")
2. ะัะฐัะทะตัะฝะฐั ะบะพะฝัะพะปั (JavaScript ะพัะธะฑะบะธ)
3. Network ะฒะบะปะฐะดะบะฐ DevTools (HTTP ััะฐััั ะพัะฒะตัะฐ)

**ะคะฐะนะปั ะปะพะณะธัะพะฒะฐะฝะธั:**
- `StatisticsExcelExportService.log.info/error` - ะณะตะฝะตัะฐัะธั Excel
- `ExportStatisticsController.log.error` - ะพัะธะฑะบะธ endpoint

**ะัะธัะธัะฝัะต ัะพัะบะธ ะพัะบะฐะทะฐ:**
1. PathResolver ะฝะต ัะพะทะดะฐัั ะฒัะตะผะตะฝะฝัะน ัะฐะนะป โ ะฟัะพะฒะตัะธัั ะฟัะฐะฒะฐ ะดะพัััะฟะฐ
2. SXSSFWorkbook.write() ะฟะฐะดะฐะตั โ ะฟัะพะฒะตัะธัั ะฟะฐะผััั JVM
3. FileSystemResource ะฝะต ะฝะฐัะพะดะธั ัะฐะนะป โ ะฟัะพะฒะตัะธัั ัััะตััะฒะพะฒะฐะฝะธะต ัะฐะนะปะฐ

---

## ะะตะทัะผะต

**ะงัะพ ัะฐะฑะพัะฐะตั:**
โ ะะพะปะฝัะน ััะฝะบัะธะพะฝะฐะป ัะบัะฟะพััะฐ ััะฐัะธััะธะบะธ ะฒ Excel
โ ะะพะดะดะตัะถะบะฐ ะฒัะตั ัะธะปัััะพะฒ ะธ ะฝะฐัััะพะตะบ
โ ะฆะฒะตัะพะฒะพะต ะบะพะดะธัะพะฒะฐะฝะธะต ะธ ัะพัะผะฐัะธัะพะฒะฐะฝะธะต
โ ะะฟัะธะผะธะทะฐัะธั ะดะปั ะฑะพะปััะธั ะพะฑััะผะพะฒ ะดะฐะฝะฝัั

**ะงัะพ ะฝัะถะฝะพ ะฟัะพัะตััะธัะพะฒะฐัั:**
โ๏ธ ะะตะฐะปัะฝัะต ะดะฐะฝะฝัะต ะธะท ะฟัะพะดะฐะบัะตะฝะฐ
โ๏ธ ะัะฐะฝะธัะฝัะต ัะปััะฐะธ (ะฟััััะต ะณััะฟะฟั, ะฑะพะปััะธะต ะพะฑััะผั)
โ๏ธ ะกะพะฒะผะตััะธะผะพััั ั ัะฐะทะฝัะผะธ ะฒะตััะธัะผะธ Excel

**ะะพัะพะฒะฝะพััั ะบ ะฟัะพะดะฐะบัะตะฝั:**
๐ข ะะพะด ะณะพัะพะฒ ะบ ัะตััะธัะพะฒะฐะฝะธั
๐ก ะขัะตะฑัะตััั ัััะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต
๐ก ะะตะบะพะผะตะฝะดัะตััั ะผะพะฝะธัะพัะธะฝะณ ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััะธ

---

**ะะฐัะฐ ัะพะทะดะฐะฝะธั ะดะพะบัะผะตะฝัะฐ:** 2025-10-23
**ะะฒัะพั:** Claude Code Assistant
**ะะตััะธั:** 1.0
